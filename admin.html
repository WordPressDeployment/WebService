<html>
  <head>
    <title>mCylia Management</title>
    <script src="https://cdn.jsdelivr.net/npm/webject@latest/for_browser.min.js"></script>
  </head>
  <body>
    <script>
      function box_proxy(obj,id){
        let box=document.createElement('div')
        let online=document.createElement('span')
        let b=document.createElement('b')
        b.innerText=id
        const handler={
          get(target,prop,receiver){return target[prop]},
          set(target,prop,value,receiver){
            target[prop]=value
            if(prop==="online"){
              if(value) online.innerText="online",online.style.backgroundColor="lightgreen";
              else online.innerText="offline",online.style.backgroundColor="#FF7F00";
            }
          }
        }
        let proxy=new Proxy(obj,handler)
        proxy.online=proxy.online //invoke the setter
        box.append(b,online)
        document.body.appendChild(box)
        return proxy
      }
      function boxes_proxy(obj){
        const handler={
          get(target,prop,receiver){return target[prop]},
          set(target,prop,value,receiver){
            if(typeof value!=="object") return;
            target[prop]=box_proxy(value,prop)
          }
        }
        return new Proxy(obj,handler)
      }
      window.onload=async function(){
        localStorage.authorisation ||= prompt("Enter Authorisation Token")
        const boxes=boxes_proxy({}), uri=`ws${location.protocol[4]==='s'?'s':''}://`+location.host, token=localStorage.authorisation
        await connect(uri, token, function(){connect(uri,token,arguments.callee,boxes)}, boxes)
        //the ideal is that boxes is a proxy so that html is rendered upon object changes :D
        //but as of right now there is 0 display LOL
        console.log(window.boxes=boxes,"incorrectly, the iframe code is being used to show this data, window.boxes is the actual data")
      }
    </script>
  </body>
</html>